# API æ–‡æ¡£

## æ¥å£æ±‡æ€»è¡¨

| æ–¹æ³• | è·¯å¾„ | é‰´æƒ | åŠŸèƒ½ | è¯·æ±‚ä½“ |
|------|------|------|------|--------|
| GET | `/health` | âŒ æ—  | å¥åº·æ£€æŸ¥ | - |
| POST | `/api/v1/auth/user/login` | âŒ æ—  | ç”¨æˆ·ç™»å½• | âœ… |
| POST | `/api/v1/auth/admin/login` | âŒ æ—  | ç®¡ç†å‘˜ç™»å½• | âœ… |
| POST | `/api/v1/auth/logout` | âœ… ç”¨æˆ· | ç”¨æˆ·ç™»å‡º | - |
| POST | `/api/v1/users/send-verification-code` | âŒ æ—  | å‘é€éªŒè¯ç  | âœ… |
| POST | `/api/v1/users/register` | âŒ æ—  | ç”¨æˆ·æ³¨å†Œ | âœ… |
| GET | `/api/v1/users/profile` | ğŸ‘¤ æœ¬äºº | è·å–ä¸ªäººä¿¡æ¯ | - |
| PUT | `/api/v1/users/:id` | ğŸ‘¤ æœ¬äºº | æ›´æ–°ç”¨æˆ·ä¿¡æ¯ | âœ… |
| DELETE | `/api/v1/users/:id` | ğŸ‘¤ æœ¬äºº | åˆ é™¤ç”¨æˆ· | - |
| GET | `/api/v1/admin/profile` | ğŸ” ç®¡ç†å‘˜ | è·å–ç®¡ç†å‘˜ä¸ªäººä¿¡æ¯ | - |
| GET | `/api/v1/admin/admins` | ğŸ” ç®¡ç†å‘˜ | è·å–ç®¡ç†å‘˜åˆ—è¡¨ | - |
| POST | `/api/v1/admin/admins` | ğŸ” ç®¡ç†å‘˜ | åˆ›å»ºç®¡ç†å‘˜ | âœ… |
| GET | `/api/v1/admin/users` | ğŸ” ç®¡ç†å‘˜ | ç®¡ç†å‘˜è·å–ç”¨æˆ·åˆ—è¡¨ | - |
| GET | `/api/v1/admin/users/:id` | ğŸ” ç®¡ç†å‘˜ | ç®¡ç†å‘˜è·å–å•ä¸ªç”¨æˆ· | - |
| PUT | `/api/v1/admin/users/:id` | ğŸ” ç®¡ç†å‘˜ | ç®¡ç†å‘˜æ›´æ–°ç”¨æˆ· | âœ… |

**é‰´æƒè¯´æ˜ï¼š**
- âŒ æ— ï¼šæ— éœ€è®¤è¯
- âœ… ç”¨æˆ·ï¼šéœ€è¦ç”¨æˆ·Tokenï¼ˆAuthMiddlewareï¼‰
- ğŸ‘¤ æœ¬äººï¼šéœ€è¦ç”¨æˆ·Tokenä¸”æ“ä½œçš„æ˜¯è‡ªå·±çš„æ•°æ®ï¼ˆSelfMiddlewareï¼‰
- ğŸ” ç®¡ç†å‘˜ï¼šéœ€è¦ç®¡ç†å‘˜Tokenï¼ˆAdminMiddlewareï¼‰

---

## æ¥å£è¯¦æƒ…

### 1. å¥åº·æ£€æŸ¥
```
GET /health
```
- é‰´æƒï¼šâŒ æ— 
- è¯·æ±‚ä½“ï¼šæ— 

---

### 2. ç”¨æˆ·ç™»å½•
```
POST /api/v1/auth/user/login
```
- é‰´æƒï¼šâŒ æ— 
- è¯·æ±‚ä½“ï¼š
```json
{
  "username": "string",  // å¿…å¡«
  "password": "string"   // å¿…å¡«
}
```

---

### 3. ç®¡ç†å‘˜ç™»å½•
```
POST /api/v1/auth/admin/login
```
- é‰´æƒï¼šâŒ æ— 
- è¯·æ±‚ä½“ï¼š
```json
{
  "username": "string",  // å¿…å¡«
  "password": "string"   // å¿…å¡«
}
```

---

### 4. ç”¨æˆ·ç™»å‡º
```
POST /api/v1/auth/logout
Headers: Authorization: Bearer <access_token>
```
- é‰´æƒï¼šâœ… ç”¨æˆ·
- è¯·æ±‚ä½“ï¼šæ— 

---

### 5. å‘é€éªŒè¯ç 
```
POST /api/v1/users/send-verification-code
```
- é‰´æƒï¼šâŒ æ— 
- è¯·æ±‚ä½“ï¼š
```json
{
  "email": "user@example.com"  // å¿…å¡«ï¼Œé‚®ç®±æ ¼å¼
}
```
- è¯´æ˜ï¼š
  - ç”¨äºæ³¨å†Œå’Œæ›´æ–°é‚®ç®±åœºæ™¯
  - å¦‚æœé‚®ç®±å·²è¢«ä½¿ç”¨ï¼Œä¼šè¿”å›é”™è¯¯ï¼ˆæ³¨å†Œå’Œæ›´æ–°é‚®ç®±éƒ½ä¸å…è®¸ä½¿ç”¨å·²è¢«ä½¿ç”¨çš„é‚®ç®±ï¼‰

---

### 6. ç”¨æˆ·æ³¨å†Œ
```
POST /api/v1/users/register
```
- é‰´æƒï¼šâŒ æ— 
- è¯·æ±‚ä½“ï¼š
```json
{
  "username": "string",     // å¿…å¡«ï¼Œ3-100å­—ç¬¦
  "email": "string",        // å¿…å¡«ï¼Œé‚®ç®±æ ¼å¼
  "password": "string",      // å¿…å¡«ï¼Œæœ€å°‘6ä½
  "captcha": "string"       // å¿…å¡«ï¼Œ6ä½éªŒè¯ç 
}
```

---

### 7. è·å–ä¸ªäººä¿¡æ¯
```
GET /api/v1/users/profile
Headers: Authorization: Bearer <access_token>
```
- é‰´æƒï¼šğŸ‘¤ æœ¬äººï¼ˆä»Tokenä¸­è·å–ç”¨æˆ·IDï¼Œè·å–æœ¬äººçš„ä¸ªäººä¿¡æ¯ï¼‰
- è¯·æ±‚ä½“ï¼šæ— 
- è·¯å¾„å‚æ•°ï¼šæ— 

---

### 8. æ›´æ–°ç”¨æˆ·ä¿¡æ¯
```
PUT /api/v1/users/:id
Headers: Authorization: Bearer <access_token>
```
- é‰´æƒï¼šğŸ‘¤ æœ¬äººï¼ˆè·¯å¾„å‚æ•°idå¿…é¡»ä¸Tokenä¸­çš„ç”¨æˆ·IDä¸€è‡´ï¼‰
- è·¯å¾„å‚æ•°ï¼š`id` (ç”¨æˆ·ID)
- è¯·æ±‚ä½“ï¼š
```json
{
  "username": "string",     // å¯é€‰ï¼Œ3-100å­—ç¬¦
  "password": "string",     // å¯é€‰ï¼Œæœ€å°‘6ä½
  "email": "string",        // å¯é€‰ï¼Œæ–°é‚®ç®±ï¼ˆæ›´æ–°é‚®ç®±æ—¶å¿…å¡«ï¼‰
  "email_code": "string"   // å¯é€‰ï¼Œé‚®ç®±éªŒè¯ç ï¼ˆæ›´æ–°é‚®ç®±æ—¶å¿…å¡«ï¼Œ6ä½æ•°å­—ï¼‰
}
```
- è¯´æ˜ï¼š
  - æ‰€æœ‰å­—æ®µå‡ä¸ºå¯é€‰ï¼Œåªæ›´æ–°æä¾›çš„å­—æ®µ
  - æ›´æ–°é‚®ç®±éœ€è¦éªŒè¯ç ï¼šå…ˆè°ƒç”¨ `/api/v1/users/send-verification-code` å‘é€éªŒè¯ç åˆ°æ–°é‚®ç®±ï¼Œç„¶ååœ¨æ›´æ–°è¯·æ±‚ä¸­åŒæ—¶æä¾› `email` å’Œ `email_code`
  - ä¸å…è®¸ä¿®æ”¹ç§¯åˆ†ï¼ˆ`points` å­—æ®µä¼šè¢«æ‹’ç»ï¼‰

---

### 10. åˆ é™¤ç”¨æˆ·
```
DELETE /api/v1/users/:id
Headers: Authorization: Bearer <access_token>
```
- é‰´æƒï¼šğŸ‘¤ æœ¬äººï¼ˆè·¯å¾„å‚æ•°idå¿…é¡»ä¸Tokenä¸­çš„ç”¨æˆ·IDä¸€è‡´ï¼‰
- è·¯å¾„å‚æ•°ï¼š`id` (ç”¨æˆ·ID)
- è¯·æ±‚ä½“ï¼šæ— 

---

### 11. è·å–ç®¡ç†å‘˜ä¸ªäººä¿¡æ¯
```
GET /api/v1/admin/profile
Headers: Authorization: Bearer <admin_access_token>
```
- é‰´æƒï¼šğŸ” ç®¡ç†å‘˜ï¼ˆä»Tokenä¸­è·å–ç®¡ç†å‘˜IDï¼Œè·å–æœ¬äººçš„ä¸ªäººä¿¡æ¯ï¼‰
- è¯·æ±‚ä½“ï¼šæ— 
- è·¯å¾„å‚æ•°ï¼šæ— 

---

### 12. ç®¡ç†å‘˜è·å–ç”¨æˆ·åˆ—è¡¨
```
GET /api/v1/admin/users?page=1&page_size=10&username_like=test&points_min=100&order_by=points&order=desc
Headers: Authorization: Bearer <admin_access_token>
```
- é‰´æƒï¼šğŸ” ç®¡ç†å‘˜
- è¯·æ±‚ä½“ï¼šæ— 
- è·¯å¾„å‚æ•°ï¼šæ— 
- æŸ¥è¯¢å‚æ•°ï¼š
  - **åˆ†é¡µå‚æ•°ï¼š**
    - `page` (å¯é€‰ï¼Œé»˜è®¤1)ï¼šé¡µç ï¼Œä»1å¼€å§‹
    - `page_size` (å¯é€‰ï¼Œé»˜è®¤10ï¼Œæœ€å¤§100)ï¼šæ¯é¡µæ•°é‡
  - **ç²¾ç¡®æŸ¥è¯¢ï¼š**
    - `id` (å¯é€‰)ï¼šç”¨æˆ·ID
    - `username` (å¯é€‰)ï¼šç”¨æˆ·åï¼ˆç²¾ç¡®åŒ¹é…ï¼‰
    - `email` (å¯é€‰)ï¼šé‚®ç®±ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰
    - `email_verified` (å¯é€‰ï¼Œtrue/false)ï¼šé‚®ç®±æ˜¯å¦å·²éªŒè¯
  - **æ¨¡ç³ŠæŸ¥è¯¢ï¼š**
    - `username_like` (å¯é€‰)ï¼šç”¨æˆ·åï¼ˆæ¨¡ç³ŠåŒ¹é…ï¼ŒLIKE %value%ï¼‰
    - `email_like` (å¯é€‰)ï¼šé‚®ç®±ï¼ˆæ¨¡ç³ŠåŒ¹é…ï¼ŒLIKE %value%ï¼‰
  - **èŒƒå›´æŸ¥è¯¢ï¼š**
    - `points_min` (å¯é€‰)ï¼šç§¯åˆ†æœ€å°å€¼ï¼ˆ>=ï¼‰ã€‚**ç‰¹æ®Šé€»è¾‘**ï¼šå½“å€¼ä¸º 0 æ—¶ï¼ŒåŒ¹é…ç§¯åˆ†ä¸º NULL æˆ– 0 çš„è®°å½•ï¼ˆNULL åœ¨é€»è¾‘ä¸Šç­‰äº 0ï¼‰
    - `points_max` (å¯é€‰)ï¼šç§¯åˆ†æœ€å¤§å€¼ï¼ˆ<=ï¼‰ã€‚**ç‰¹æ®Šé€»è¾‘**ï¼šå½“å€¼ä¸º 0 æ—¶ï¼ŒåŒ¹é…ç§¯åˆ†ä¸º NULL æˆ– 0 çš„è®°å½•ï¼›å½“å€¼ > 0 æ—¶ï¼ŒåŒ¹é…ç§¯åˆ†ä¸º NULL æˆ– <= è¯¥å€¼çš„è®°å½•ï¼ˆNULL åœ¨é€»è¾‘ä¸Šç­‰äº 0ï¼‰
    - `created_at_min` (å¯é€‰)ï¼šåˆ›å»ºæ—¶é—´æœ€å°å€¼ï¼ˆ>=ï¼ŒUnixæ—¶é—´æˆ³ï¼‰
    - `created_at_max` (å¯é€‰)ï¼šåˆ›å»ºæ—¶é—´æœ€å¤§å€¼ï¼ˆ<=ï¼ŒUnixæ—¶é—´æˆ³ï¼‰
  - **æ’åºï¼š**
    - `order_by` (å¯é€‰)ï¼šæ’åºå­—æ®µï¼ˆid, username, email, points, created_at, updated_atï¼‰
    - `order` (å¯é€‰ï¼Œé»˜è®¤desc)ï¼šæ’åºæ–¹å‘ï¼ˆasc, descï¼‰
- è¯´æ˜ï¼š
  - æ‰€æœ‰æŸ¥è¯¢å‚æ•°å‡ä¸ºå¯é€‰ï¼Œå¯ç»„åˆä½¿ç”¨
  - å¦‚æœä¸æŒ‡å®š `order_by`ï¼ŒæŒ‰æ•°æ®åº“é»˜è®¤é¡ºåºè¿”å›
  - æŸ¥è¯¢æ¡ä»¶ä¹‹é—´ä¸º AND å…³ç³»

---

### 13. ç®¡ç†å‘˜è·å–å•ä¸ªç”¨æˆ·
```
GET /api/v1/admin/users/:id
Headers: Authorization: Bearer <admin_access_token>
```
- é‰´æƒï¼šğŸ” ç®¡ç†å‘˜
- è¯·æ±‚ä½“ï¼šæ— 
- è·¯å¾„å‚æ•°ï¼š`id` (ç”¨æˆ·ID)

---

### 14. è·å–ç®¡ç†å‘˜åˆ—è¡¨
```
GET /api/v1/admin/admins?page=1&page_size=10&username_like=test&created_at_min=1000000000&order_by=created_at&order=desc
Headers: Authorization: Bearer <admin_access_token>
```
- é‰´æƒï¼šğŸ” ç®¡ç†å‘˜
- è¯·æ±‚ä½“ï¼šæ— 
- è·¯å¾„å‚æ•°ï¼šæ— 
- æŸ¥è¯¢å‚æ•°ï¼š
  - **åˆ†é¡µå‚æ•°ï¼š**
    - `page` (å¯é€‰ï¼Œé»˜è®¤1)ï¼šé¡µç ï¼Œä»1å¼€å§‹
    - `page_size` (å¯é€‰ï¼Œé»˜è®¤10ï¼Œæœ€å¤§100)ï¼šæ¯é¡µæ•°é‡
  - **ç²¾ç¡®æŸ¥è¯¢ï¼š**
    - `id` (å¯é€‰)ï¼šç®¡ç†å‘˜ID
    - `username` (å¯é€‰)ï¼šç”¨æˆ·åï¼ˆç²¾ç¡®åŒ¹é…ï¼‰
  - **æ¨¡ç³ŠæŸ¥è¯¢ï¼š**
    - `username_like` (å¯é€‰)ï¼šç”¨æˆ·åï¼ˆæ¨¡ç³ŠåŒ¹é…ï¼ŒLIKE %value%ï¼‰
  - **èŒƒå›´æŸ¥è¯¢ï¼š**
    - `created_at_min` (å¯é€‰)ï¼šåˆ›å»ºæ—¶é—´æœ€å°å€¼ï¼ˆ>=ï¼ŒUnixæ—¶é—´æˆ³ï¼‰
    - `created_at_max` (å¯é€‰)ï¼šåˆ›å»ºæ—¶é—´æœ€å¤§å€¼ï¼ˆ<=ï¼ŒUnixæ—¶é—´æˆ³ï¼‰
    - `updated_at_min` (å¯é€‰)ï¼šæ›´æ–°æ—¶é—´æœ€å°å€¼ï¼ˆ>=ï¼ŒUnixæ—¶é—´æˆ³ï¼‰
    - `updated_at_max` (å¯é€‰)ï¼šæ›´æ–°æ—¶é—´æœ€å¤§å€¼ï¼ˆ<=ï¼ŒUnixæ—¶é—´æˆ³ï¼‰
  - **æ’åºï¼š**
    - `order_by` (å¯é€‰)ï¼šæ’åºå­—æ®µï¼ˆid, username, created_at, updated_atï¼‰
    - `order` (å¯é€‰ï¼Œé»˜è®¤desc)ï¼šæ’åºæ–¹å‘ï¼ˆasc, descï¼‰
- è¯´æ˜ï¼š
  - æ‰€æœ‰æŸ¥è¯¢å‚æ•°å‡ä¸ºå¯é€‰ï¼Œå¯ç»„åˆä½¿ç”¨
  - å¦‚æœä¸æŒ‡å®š `order_by`ï¼ŒæŒ‰æ•°æ®åº“é»˜è®¤é¡ºåºè¿”å›
  - æŸ¥è¯¢æ¡ä»¶ä¹‹é—´ä¸º AND å…³ç³»
- å“åº”ä½“ï¼ˆåˆ†é¡µæ ¼å¼ï¼‰ï¼š
```json
{
  "code": 200,
  "success": true,
  "data": {
    "list": [
      {
        "id": 1,
        "username": "string",
        "created_at": 1234567890,
        "updated_at": 1234567890
      }
    ],
    "pagination": {
      "page": 1,
      "page_size": 10,
      "total": 100,
      "pages": 10
    }
  }
}
```

---

### 15. åˆ›å»ºç®¡ç†å‘˜
```
POST /api/v1/admin/admins
Headers: Authorization: Bearer <admin_access_token>
```
- é‰´æƒï¼šğŸ” ç®¡ç†å‘˜
- è·¯å¾„å‚æ•°ï¼šæ— 
- è¯·æ±‚ä½“ï¼š
```json
{
  "username": "string",  // å¿…å¡«ï¼Œ3-100å­—ç¬¦
  "password": "string"   // å¿…å¡«ï¼Œæœ€å°‘6ä½
}
```
- è¯´æ˜ï¼š
  - ç”¨æˆ·åå¿…é¡»å”¯ä¸€ï¼Œå¦‚æœå·²å­˜åœ¨ä¼šè¿”å›é”™è¯¯
  - å¯†ç ä¼šè‡ªåŠ¨åŠ å¯†å­˜å‚¨
  - åˆ›å»ºæˆåŠŸè¿”å›åˆ›å»ºçš„ç®¡ç†å‘˜ä¿¡æ¯ï¼ˆä¸åŒ…å«å¯†ç ï¼‰
- å“åº”ä½“ï¼š
```json
{
  "code": 201,
  "success": true,
  "message": "åˆ›å»ºæˆåŠŸ",
  "data": {
    "id": 1,
    "username": "admin123",
    "created_at": 1234567890,
    "updated_at": 1234567890
  },
  "timestamp": 1234567890
}
```

---

### 16. ç®¡ç†å‘˜æ›´æ–°ç”¨æˆ·
```
PUT /api/v1/admin/users/:id
Headers: Authorization: Bearer <admin_access_token>
```
- é‰´æƒï¼šğŸ” ç®¡ç†å‘˜
- è·¯å¾„å‚æ•°ï¼š`id` (ç”¨æˆ·ID)
- è¯·æ±‚ä½“ï¼š
```json
{
  "points": 0  // å¯é€‰ï¼Œç§¯åˆ†å€¼ã€‚null=ç½®ç©ºï¼ˆç­‰åŒäº0ï¼‰ï¼Œ0=ç½®ä¸º0ï¼Œå…¶ä»–æ•°å€¼=è®¾ç½®å¯¹åº”ç§¯åˆ†
}
```
- è¯´æ˜ï¼š
  - ç®¡ç†å‘˜åªèƒ½æ›´æ–°ç”¨æˆ·ç§¯åˆ†
  - `points` å­—æ®µæ”¯æŒä¸‰ç§æ“ä½œï¼š
    - ä¸ä¼ ï¼šä¸æ›´æ–°ç§¯åˆ†å­—æ®µ
    - `null`ï¼šå°†ç§¯åˆ†ç½®ç©ºï¼ˆNULLï¼Œé€»è¾‘ä¸Šç­‰åŒäº0ï¼‰
    - `0` æˆ–å…¶ä»–æ•°å€¼ï¼šè®¾ç½®å¯¹åº”çš„ç§¯åˆ†å€¼

---

## æ³¨æ„äº‹é¡¹

1. æ‰€æœ‰éœ€è¦é‰´æƒçš„æ¥å£éƒ½éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦ `Authorization: Bearer <token>`
2. è¯·æ±‚ä½“ä¸º JSON æ ¼å¼ï¼ŒContent-Type: application/json
3. æ‰€æœ‰å­—æ®µéªŒè¯å¤±è´¥ä¼šè¿”å› 400 é”™è¯¯
4. æœªçŸ¥å­—æ®µä¼šè¢«æ‹’ç»ï¼Œè¿”å› 400 é”™è¯¯
5. ç§¯åˆ†å­—æ®µ `points` ä¸ºå¯é€‰å­—æ®µï¼Œæ”¯æŒ `null`ã€`0` å’Œå…¶ä»–æ•°å€¼
