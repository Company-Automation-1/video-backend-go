# API æ–‡æ¡£

## æ¥å£æ±‡æ€»è¡¨

| æ–¹æ³• | è·¯å¾„ | é‰´æƒ | åŠŸèƒ½ | è¯·æ±‚ä½“ |
|------|------|------|------|--------|
| GET | `/health` | âŒ æ—  | å¥åº·æ£€æŸ¥ | - |
| POST | `/api/v1/auth/user/login` | âŒ æ—  | ç”¨æˆ·ç™»å½• | âœ… |
| POST | `/api/v1/auth/admin/login` | âŒ æ—  | ç®¡ç†å‘˜ç™»å½• | âœ… |
| POST | `/api/v1/auth/logout` | âœ… ç”¨æˆ· | ç”¨æˆ·ç™»å‡º | - |
| POST | `/api/v1/users/send-verification-code` | âŒ æ—  | å‘é€éªŒè¯ç  | âœ… |
| POST | `/api/v1/users/register` | âŒ æ—  | ç”¨æˆ·æ³¨å†Œ | âœ… |
| GET | `/api/v1/users` | ğŸ” ç®¡ç†å‘˜ | è·å–ç”¨æˆ·åˆ—è¡¨ | - |
| GET | `/api/v1/users/:id` | ğŸ” ç®¡ç†å‘˜ | è·å–å•ä¸ªç”¨æˆ· | - |
| POST | `/api/v1/users/update-email` | âœ… ç”¨æˆ· | æ›´æ–°é‚®ç®± | âœ… |
| PUT | `/api/v1/users/:id` | ğŸ‘¤ æœ¬äºº | æ›´æ–°ç”¨æˆ·ä¿¡æ¯ | âœ… |
| DELETE | `/api/v1/users/:id` | ğŸ‘¤ æœ¬äºº | åˆ é™¤ç”¨æˆ· | - |
| GET | `/api/v1/admin/users` | ğŸ” ç®¡ç†å‘˜ | ç®¡ç†å‘˜è·å–ç”¨æˆ·åˆ—è¡¨ | - |
| GET | `/api/v1/admin/users/:id` | ğŸ” ç®¡ç†å‘˜ | ç®¡ç†å‘˜è·å–å•ä¸ªç”¨æˆ· | - |
| PUT | `/api/v1/admin/users/:id` | ğŸ” ç®¡ç†å‘˜ | ç®¡ç†å‘˜æ›´æ–°ç”¨æˆ· | âœ… |

**é‰´æƒè¯´æ˜ï¼š**
- âŒ æ— ï¼šæ— éœ€è®¤è¯
- âœ… ç”¨æˆ·ï¼šéœ€è¦ç”¨æˆ·Tokenï¼ˆAuthMiddlewareï¼‰
- ğŸ” ç®¡ç†å‘˜ï¼šéœ€è¦ç®¡ç†å‘˜Tokenï¼ˆAdminMiddlewareï¼‰
- ğŸ‘¤ æœ¬äººï¼šéœ€è¦ç”¨æˆ·Tokenä¸”æ“ä½œçš„æ˜¯è‡ªå·±çš„æ•°æ®ï¼ˆSelfMiddlewareï¼‰

---

## æ¥å£è¯¦æƒ…

### 1. å¥åº·æ£€æŸ¥
```
GET /health
```
- é‰´æƒï¼šâŒ æ— 
- è¯·æ±‚ä½“ï¼šæ— 

---

### 2. ç”¨æˆ·ç™»å½•
```
POST /api/v1/auth/user/login
```
- é‰´æƒï¼šâŒ æ— 
- è¯·æ±‚ä½“ï¼š
```json
{
  "username": "string",  // å¿…å¡«
  "password": "string"   // å¿…å¡«
}
```

---

### 3. ç®¡ç†å‘˜ç™»å½•
```
POST /api/v1/auth/admin/login
```
- é‰´æƒï¼šâŒ æ— 
- è¯·æ±‚ä½“ï¼š
```json
{
  "username": "string",  // å¿…å¡«
  "password": "string"   // å¿…å¡«
}
```

---

### 4. ç”¨æˆ·ç™»å‡º
```
POST /api/v1/auth/logout
Headers: Authorization: Bearer <access_token>
```
- é‰´æƒï¼šâœ… ç”¨æˆ·
- è¯·æ±‚ä½“ï¼šæ— 

---

### 5. å‘é€éªŒè¯ç 
```
POST /api/v1/users/send-verification-code
```
- é‰´æƒï¼šâŒ æ— 
- è¯·æ±‚ä½“ï¼š
```json
{
  "email": "user@example.com"  // å¿…å¡«ï¼Œé‚®ç®±æ ¼å¼
}
```

---

### 6. ç”¨æˆ·æ³¨å†Œ
```
POST /api/v1/users/register
```
- é‰´æƒï¼šâŒ æ— 
- è¯·æ±‚ä½“ï¼š
```json
{
  "username": "string",     // å¿…å¡«ï¼Œ3-100å­—ç¬¦
  "email": "string",        // å¿…å¡«ï¼Œé‚®ç®±æ ¼å¼
  "password": "string",      // å¿…å¡«ï¼Œæœ€å°‘6ä½
  "captcha": "string"       // å¿…å¡«ï¼Œ6ä½éªŒè¯ç 
}
```

---

### 7. è·å–ç”¨æˆ·åˆ—è¡¨
```
GET /api/v1/users
Headers: Authorization: Bearer <admin_access_token>
```
- é‰´æƒï¼šğŸ” ç®¡ç†å‘˜
- è¯·æ±‚ä½“ï¼šæ— 
- è·¯å¾„å‚æ•°ï¼šæ— 

---

### 8. è·å–å•ä¸ªç”¨æˆ·
```
GET /api/v1/users/:id
Headers: Authorization: Bearer <admin_access_token>
```
- é‰´æƒï¼šğŸ” ç®¡ç†å‘˜
- è¯·æ±‚ä½“ï¼šæ— 
- è·¯å¾„å‚æ•°ï¼š`id` (ç”¨æˆ·ID)

---

### 9. æ›´æ–°é‚®ç®±
```
POST /api/v1/users/update-email
Headers: Authorization: Bearer <access_token>
```
- é‰´æƒï¼šâœ… ç”¨æˆ·
- è¯·æ±‚ä½“ï¼š
```json
{
  "email": "newemail@example.com",  // å¿…å¡«ï¼Œæ–°é‚®ç®±
  "code": "123456"                  // å¿…å¡«ï¼Œ6ä½éªŒè¯ç 
}
```

---

### 10. æ›´æ–°ç”¨æˆ·ä¿¡æ¯
```
PUT /api/v1/users/:id
Headers: Authorization: Bearer <access_token>
```
- é‰´æƒï¼šğŸ‘¤ æœ¬äººï¼ˆè·¯å¾„å‚æ•°idå¿…é¡»ä¸Tokenä¸­çš„ç”¨æˆ·IDä¸€è‡´ï¼‰
- è·¯å¾„å‚æ•°ï¼š`id` (ç”¨æˆ·ID)
- è¯·æ±‚ä½“ï¼š
```json
{
  "username": "string",  // å¯é€‰ï¼Œ3-100å­—ç¬¦
  "password": "string",  // å¯é€‰ï¼Œæœ€å°‘6ä½
  "points": 0            // å¯é€‰ï¼Œç§¯åˆ†å€¼ã€‚null=ç½®ç©ºï¼ˆç­‰åŒäº0ï¼‰ï¼Œ0=ç½®ä¸º0ï¼Œå…¶ä»–æ•°å€¼=è®¾ç½®å¯¹åº”ç§¯åˆ†
}
```
- è¯´æ˜ï¼š
  - æ‰€æœ‰å­—æ®µå‡ä¸ºå¯é€‰ï¼Œåªæ›´æ–°æä¾›çš„å­—æ®µ
  - `points` å­—æ®µæ”¯æŒä¸‰ç§æ“ä½œï¼š
    - ä¸ä¼ ï¼šä¸æ›´æ–°ç§¯åˆ†å­—æ®µ
    - `null`ï¼šå°†ç§¯åˆ†ç½®ç©ºï¼ˆNULLï¼Œé€»è¾‘ä¸Šç­‰åŒäº0ï¼‰
    - `0` æˆ–å…¶ä»–æ•°å€¼ï¼šè®¾ç½®å¯¹åº”çš„ç§¯åˆ†å€¼

---

### 11. åˆ é™¤ç”¨æˆ·
```
DELETE /api/v1/users/:id
Headers: Authorization: Bearer <access_token>
```
- é‰´æƒï¼šğŸ‘¤ æœ¬äººï¼ˆè·¯å¾„å‚æ•°idå¿…é¡»ä¸Tokenä¸­çš„ç”¨æˆ·IDä¸€è‡´ï¼‰
- è·¯å¾„å‚æ•°ï¼š`id` (ç”¨æˆ·ID)
- è¯·æ±‚ä½“ï¼šæ— 

---

### 12. ç®¡ç†å‘˜è·å–ç”¨æˆ·åˆ—è¡¨
```
GET /api/v1/admin/users
Headers: Authorization: Bearer <admin_access_token>
```
- é‰´æƒï¼šğŸ” ç®¡ç†å‘˜
- è¯·æ±‚ä½“ï¼šæ— 
- è·¯å¾„å‚æ•°ï¼šæ— 

---

### 13. ç®¡ç†å‘˜è·å–å•ä¸ªç”¨æˆ·
```
GET /api/v1/admin/users/:id
Headers: Authorization: Bearer <admin_access_token>
```
- é‰´æƒï¼šğŸ” ç®¡ç†å‘˜
- è¯·æ±‚ä½“ï¼šæ— 
- è·¯å¾„å‚æ•°ï¼š`id` (ç”¨æˆ·ID)

---

### 14. ç®¡ç†å‘˜æ›´æ–°ç”¨æˆ·
```
PUT /api/v1/admin/users/:id
Headers: Authorization: Bearer <admin_access_token>
```
- é‰´æƒï¼šğŸ” ç®¡ç†å‘˜
- è·¯å¾„å‚æ•°ï¼š`id` (ç”¨æˆ·ID)
- è¯·æ±‚ä½“ï¼š
```json
{
  "username": "string",  // å¯é€‰ï¼Œ3-100å­—ç¬¦
  "password": "string",  // å¯é€‰ï¼Œæœ€å°‘6ä½
  "points": 0            // å¯é€‰ï¼Œç§¯åˆ†å€¼ã€‚null=ç½®ç©ºï¼ˆç­‰åŒäº0ï¼‰ï¼Œ0=ç½®ä¸º0ï¼Œå…¶ä»–æ•°å€¼=è®¾ç½®å¯¹åº”ç§¯åˆ†
}
```
- è¯´æ˜ï¼šç®¡ç†å‘˜å¯ä»¥æ›´æ–°ä»»æ„ç”¨æˆ·çš„ç§¯åˆ†

---

## æ³¨æ„äº‹é¡¹

1. æ‰€æœ‰éœ€è¦é‰´æƒçš„æ¥å£éƒ½éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦ `Authorization: Bearer <token>`
2. è¯·æ±‚ä½“ä¸º JSON æ ¼å¼ï¼ŒContent-Type: application/json
3. æ‰€æœ‰å­—æ®µéªŒè¯å¤±è´¥ä¼šè¿”å› 400 é”™è¯¯
4. æœªçŸ¥å­—æ®µä¼šè¢«æ‹’ç»ï¼Œè¿”å› 400 é”™è¯¯
5. ç§¯åˆ†å­—æ®µ `points` ä¸ºå¯é€‰å­—æ®µï¼Œæ”¯æŒ `null`ã€`0` å’Œå…¶ä»–æ•°å€¼
